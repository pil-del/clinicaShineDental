<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gestión de Doctores</title>
    <link rel="shortcut icon" type="image/png" href="/images/shine.png">
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css">
    <link rel="stylesheet" href="https://cdn.datatables.net/1.10.21/css/jquery.dataTables.min.css">
    <link rel="stylesheet" href="/css/dashboard.css">
    <style>
        /* Estilo para los botones de paginación */
        .dataTables_wrapper .dataTables_paginate .paginate_button {
            color: #007bff;
            background-color: transparent;
            border: none;
            padding: 0;
            margin: 0 5px;
            font-size: 14px;
            cursor: pointer;
        }

        /* Estilo para el botón de la página actual */
        .dataTables_wrapper .dataTables_paginate .paginate_button.current {
            font-weight: bold;
            color: white;
            background-color: #007bff;
            border: none;
            border-radius: 4px;
        }

        /* Estilo para el botón de paginación al pasar el mouse por encima */
        .dataTables_wrapper .dataTables_paginate .paginate_button:hover {
            color: white;
            background-color: #0056b3;
            border: none;
            border-radius: 4px;
        }

        /* Oculta el cuadro de búsqueda predeterminado de DataTables */
        .dataTables_filter {
          display: none;
        }

        html, body {
            height: 100%;
            margin: 0;
            padding: 0;
            display: flex;
            flex-direction: column;
        }

        #page-content-wrapper {
            flex: 1;
        }

        footer {
            position: relative;
            bottom: 0;
            width: 100%;
            background-color: #343a40;
            color: white;
            text-align: center;
            padding: 10px 0;
        }
    </style>
</head>
<body>
    <div class="d-flex" id="wrapper">
        <!-- Sidebar -->
        <div class="bg-dark border-right" id="sidebar-wrapper">
            <div class="sidebar-heading text-white">
                <div>
                    <img src="/images/shine.png" alt="Logo" class="img-fluid mb-2" style="max-width: 50px;">
                    SHINE DENTAL
                </div>
            </div>
            <div class="list-group list-group-flush">
                <a href="#clientes-pacientes-submenu" class="list-group-item list-group-item-action bg-dark text-white" data-toggle="collapse">
                    <i class="fas fa-user"></i> Pacientes
                </a>
                <div id="clientes-pacientes-submenu" class="collapse">
                    <a href="/admin/pacientes" class="list-group-item list-group-item-action bg-dark text-white pl-4">Pacientes</a>
                    <a href="/admin/citas" class="list-group-item list-group-item-action bg-dark text-white pl-4">Citas</a>
                    <a href="/admin/historial" class="list-group-item list-group-item-action bg-dark text-white pl-4">Historial Tratamiento</a>
                    <a href="/admin/pago" class="list-group-item list-group-item-action bg-dark text-white pl-4">Control de Pago</a>
                    <a href="/admin/archivados" class="list-group-item list-group-item-action bg-dark text-white pl-4">Pacientes Archivados</a>
                </div>
                <a href="#doctores-submenu" class="list-group-item list-group-item-action bg-dark text-white" data-toggle="collapse">
                    <i class="fas fa-user-md"></i> Doctores
                </a>
                <div id="doctores-submenu" class="collapse">
                    <a href="/admin/doctores" class="list-group-item list-group-item-action bg-dark text-white pl-4 active">Doctores</a>
                    <a href="/admin/usuarios" class="list-group-item list-group-item-action bg-dark text-white pl-4">Usuarios Activos</a>
                    <a href="/admin/usuariosinactivos" class="list-group-item list-group-item-action bg-dark text-white pl-4">Usuarios Inactivos</a>
                </div>
                <a href="#inventario-submenu" class="list-group-item list-group-item-action bg-dark text-white" data-toggle="collapse">
                    <i class="fas fa-box"></i> Inventario
                </a>
                <div id="inventario-submenu" class="collapse">
                    <a href="/admin/inventario" class="list-group-item list-group-item-action bg-dark text-white pl-4">Inventario</a>
                    <a href="/admin/compra" class="list-group-item list-group-item-action bg-dark text-white pl-4">Compra</a>
                </div>

                <a href="#reportes-submenu" class="list-group-item list-group-item-action bg-dark text-white" data-toggle="collapse">
                    <i class="fas fa-chart-bar"></i> Reportes
                </a>
                
                <a href="/admin/dashboard" class="list-group-item list-group-item-action bg-dark text-white">
                    <i class="fas fa-arrow-circle-left"></i> Regresar al Panel
                </a>
            
                <a href="/admin/login" class="list-group-item list-group-item-action bg-danger text-white">
                    <i class="fas fa-sign-out-alt"></i> Cerrar Sesión
                </a>
            </div>
            <!-- Botón de flecha -->
            <button class="btn btn-dark toggle-btn" id="menu-toggle">
                <i class="fas fa-chevron-left"></i>
            </button>
        </div>
        <!-- /#sidebar-wrapper -->

        <!-- Page Content -->
        <div id="page-content-wrapper">
            <div class="container-fluid">
                <h1 class="mt-4">Lista de Doctores</h1>
                <div class="text-left mb-3">
                    <a href="/admin/dashboard" class="btn btn-secondary">&larr; Regresar al Panel de Control</a>
                    <button class="btn btn-primary" data-toggle="modal" data-target="#addDoctorModal">Agregar Doctor/Auxiliar</button>
                </div>

                <!-- Barra de búsqueda -->
                <div class="input-group mb-3">
                    <input type="text" class="form-control" placeholder="Buscar doctor..." id="searchDoctor">
                </div>

                <!-- Tabla de doctores -->
                <div class="text-right mb-3"></div>
                <table class="table table-bordered" id="doctorTable">
                    <thead>
                        <tr>
                            <th>ID</th>
                            <th>Usuario</th>
                            <th>Nombre</th>
                            <th>Especialidad</th>
                            <th>Acciones</th>
                        </tr>
                    </thead>
                    <tbody id="doctorList">
                        <% doctores.forEach(function(doctor) { %>
                        <tr>
                            <td><%= doctor.iddoctor %></td>
                            <td><%= doctor.usuario_idusuario %></td>
                            <td><%= doctor.nombre  + " " + doctor.apellido %></td>
                            <td>
                                <% if (doctor.especialidad_idespecialidad == 1) { %>
                                    Dentista General
                                <% } else if (doctor.especialidad_idespecialidad == 2) { %>
                                    Ortodoncista
                                <% } else if (doctor.especialidad_idespecialidad == 3) { %>
                                    Cirujano Maxilofacial
                                <% } else if (doctor.especialidad_idespecialidad == 4) { %>
                                    Endodoncia
                                <% } else if (doctor.especialidad_idespecialidad == 5) { %>
                                    Periodoncia
                                <% } else if (doctor.especialidad_idespecialidad == 6) { %>
                                    Odontólogo Cosmético
                                <% } else if (doctor.especialidad_idespecialidad == 7) { %>
                                    Odontólogo Restaurador
                                <% } else if (doctor.especialidad_idespecialidad == 8) { %>
                                    Prótesis Dental
                                <% } else { %>
                                    Otro
                                <% } %>                                
                            </td>
                            <td>
                                <button class="btn btn-primary btn-sm" onclick="editarDoctor('<%= doctor.iddoctor %>', '<%= doctor.nombre %>', '<%= doctor.apellido %>', '<%= doctor.telefono %>', '<%= doctor.email %>', '<%= doctor.observaciones %>', '<%= doctor.especialidad_idespecialidad %>', '<%= doctor.dpi %>', '<%= doctor.fechaNacimiento %>', '<%= doctor.tipoSangre %>', '<%= doctor.genero_idGenero %>', '<%= doctor.domicilio %>')">Editar</button>
                                <button class="btn btn-primary btn-sm" onclick="verInformacion('<%= doctor.iddoctor %>', '<%= doctor.usuario_idusuario %>', '<%= doctor.nombre %>', '<%= doctor.apellido %>', '<%= doctor.telefono %>', '<%= doctor.email %>', '<%= doctor.observaciones %>', '<%= doctor.especialidad_idespecialidad %>', '<%= doctor.dpi %>', '<%= doctor.fechaNacimiento %>', '<%= doctor.tipoSangre %>', '<%= doctor.domicilio %>')">Ver Información</button>
                            </td>
                        </tr>
                        <% }); %>
                    </tbody>                    
                </table>
                
                <!-- Modal para ver información del doctor -->
                <div class="modal fade" id="infoDoctorModal" tabindex="-1" aria-labelledby="infoDoctorModalLabel" aria-hidden="true">
                    <div class="modal-dialog modal-lg">
                        <div class="modal-content">
                            <div class="modal-header">
                                <h5 class="modal-title" id="infoDoctorModalLabel">Información del Doctor</h5>
                                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                                    <span aria-hidden="true">&times;</span>
                                </button>
                            </div>
                            <div class="modal-body">
                                <dl class="row">
                                    <dt class="col-sm-3">ID:</dt>
                                    <dd class="col-sm-9" id="infoDoctorId"></dd>
                                    
                                    <dt class="col-sm-3">User ID:</dt>
                                    <dd class="col-sm-9" id="infoDoctorUserId"></dd>
                                    
                                    <dt class="col-sm-3">Nombre:</dt>
                                    <dd class="col-sm-9" id="infoDoctorName"></dd>
                                    
                                    <dt class="col-sm-3">Apellido:</dt>
                                    <dd class="col-sm-9" id="infoDoctorLastName"></dd>
                                    
                                    <dt class="col-sm-3">Especialidad:</dt>
                                    <dd class="col-sm-9" id="infoDoctorSpecialty"></dd>
                                    
                                    <dt class="col-sm-3">Teléfono:</dt>
                                    <dd class="col-sm-9" id="infoDoctorPhone"></dd>
                                    
                                    <dt class="col-sm-3">Email:</dt>
                                    <dd class="col-sm-9" id="infoDoctorEmail"></dd>
                                    
                                    <dt class="col-sm-3">DPI:</dt>
                                    <dd class="col-sm-9" id="infoDoctorDPI"></dd>
                                    
                                    <dt class="col-sm-3">Fecha de Nacimiento:</dt>
                                    <dd class="col-sm-9" id="infoDoctorBirthdate"></dd>
                                    
                                    <dt class="col-sm-3">Género:</dt>
                                    <dd class="col-sm-9" id="infoDoctorGender"></dd>
                                    
                                    <dt class="col-sm-3">Tipo de Sangre:</dt>
                                    <dd class="col-sm-9" id="infoDoctorBloodType"></dd>
                                    
                                    <dt class="col-sm-3">Domicilio:</dt>
                                    <dd class="col-sm-9" id="infoDoctorAddress"></dd>
                                    
                                    <dt class="col-sm-3">Observaciones:</dt>
                                    <dd class="col-sm-9" id="infoDoctorObservations"></dd>
                                </dl>                                                            
                            </div>
                            <div class="modal-footer">
                                <button type="button" class="btn btn-secondary" data-dismiss="modal">Cerrar</button>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Tabla de horarios laborales -->
                <div class="container mt-5">
                    <h3>Horarios Laborales Existentes</h3>
                    <table class="table table-bordered" id="horariosTable">
                        <thead>
                            <tr>
                                <th>Doctor ID</th>
                                <th>Día</th>
                                <th>Horario Inicio</th>
                                <th>Horario Fin</th>
                                <th>Acciones</th>
                            </tr>
                        </thead>
                        <tbody id="horarioList">
                            <% doctores.forEach(function(horarios_laborales) { %>
                            <tr>
                                <td><%= horarios_laborales.doctor_id %></td>
                                <td><%= horarios_laborales.dia_semana %></td>
                                <td><%= horarios_laborales.hora_inicio %></td>
                                <td><%= horarios_laborales.hora_fin %></td>
                                <td>
                                    
                                </td>
                            </tr>
                            <% }); %>
                        </tbody> 
                    </table>
                </div>

                <!-- Formulario para gestión de horarios laborales -->
                <div class="container mt-5">
                    <h2>Gestión de Horarios Laborales</h2>
                    <form id="formHorarioLaboral">
                        <div class="form-group">
                            <label for="doctor">Seleccionar Doctor:</label>
                            <select id="doctor" name="doctor_id" class="form-control">
                                <option value="">Seleccione un Doctor</option>
                                <% doctores.forEach(function(doctor) { %>
                                    <option value="<%= doctor.iddoctor %>"><%= doctor.nombre + " " + doctor.apellido %></option>
                                <% }); %>
                            </select>
                        </div>
                        
                
                        <div class="form-group">
                            <label for="diaSemana">Día de la Semana:</label>
                            <select id="diaSemana" name="dia_semana" class="form-control">
                                <option value="">Seleccione un Día</option>
                                <option value="Lunes">Lunes</option>
                                <option value="Martes">Martes</option>
                                <option value="Miércoles">Miércoles</option>
                                <option value="Jueves">Jueves</option>
                                <option value="Viernes">Viernes</option>
                                <option value="Sábado">Sábado</option>
                                <option value="Domingo">Domingo</option>
                            </select>
                        </div>
                
                        <div class="form-group">
                            <label for="horaInicio">Hora de Inicio:</label>
                            <input type="time" id="horaInicio" name="hora_inicio" class="form-control" required>
                        </div>
                
                        <div class="form-group">
                            <label for="horaFin">Hora de Fin:</label>
                            <input type="time" id="horaFin" name="hora_fin" class="form-control" required>
                        </div>
                
                        <button type="submit" class="btn btn-primary">Guardar Horario</button>
                    </form>
                
                    <!--<div id="existingSchedules" class="mt-4">
                        <h3>Horarios Existentes</h3>
                        <ul id="horarioList"></ul>
                    </div>-->
                </div>
            </div>
        </div>
        <!-- /#page-content-wrapper -->
    </div>
    <!-- /#wrapper -->

    <!-- Modal para agregar doctor -->
    <div class="modal fade" id="addDoctorModal" tabindex="-1" aria-labelledby="addDoctorModalLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="addDoctorModalLabel">Agregar Doctor Auxiliar</h5>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>
                <div class="modal-body">
                    <form action="/adddoctores" method="POST">
                        <div class="form-group">
                            <label for="dpi">DPI</label>
                            <input type="text" class="form-control" id="dpi" name="dpi" required>
                        </div>
                        <div class="form-group">
                            <label for="nombre">Nombre/s</label>
                            <input type="text" class="form-control" id="nombre" name="nombre" required>
                        </div>
                        <div class="form-group">
                            <label for="apellido">Apellido/s</label>
                            <input type="text" class="form-control" id="apellido" name="apellido" required>
                        </div>
                        <div class="form-group">
                            <label for="fechaNacimiento">Fecha de Nacimiento</label>
                            <input type="date" class="form-control" id="fechaNacimiento" name="fechaNacimiento" required>
                        </div>
                        <div class="form-group">
                            <label>Género</label>
                            <select name="genero_idGenero" class="form-control" required>
                                <option value="">Seleccione un género</option>
                                <option value="1">Masculino</option>
                                <option value="2">Femenino</option>
                                <option value="3">Otro</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="tipoSangre">Tipo de Sangre</label>
                            <input type="text" class="form-control" id="tipoSangre" name="tipoSangre">
                        </div>
                        <div class="form-group">
                            <label for="domicilio">Domicilio</label>
                            <input type="text" class="form-control" id="domicilio" name="domicilio">
                        </div>
                        <div class="form-group">
                            <label for="telefono">Teléfono</label>
                            <input type="text" class="form-control" id="telefono" name="telefono">
                        </div>
                        <div class="form-group">
                            <label for="email">Correo Electrónico</label>
                            <input type="email" class="form-control" id="email" name="email" required>
                        </div>
                        <div class="form-group">
                            <label>Especialidad</label>
                            <select name="especialidad" class="form-control" required>
                                <option value="">Seleccione una especialidad</option>
                                <option value="1">Dentista General</option>
                                <option value="2">Ortodoncista</option>
                                <option value="3">Cirujano Maxilofacial</option>
                                <option value="4">Endodoncia</option>
                                <option value="5">Periodoncia</option>
                                <option value="6">Odontólogo Cosmético</option>
                                <option value="7">Odontólogo Restaurador</option>
                                <option value="8">Prótesis Dental</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="rol">Rol</label>
                            <select id="rol" name="rol" class="form-control" required>
                                <option value="">Seleccione un rol</option>
                                <option value="1">Doctor</option>
                                <option value="2">Auxiliar</option>
                                <option value="3">Administrador</option>
                            </select>
                        </div>

                        <!-- Usuario y Contraseña -->
                        <div class="form-group">
                            <label for="user">Usuario</label>
                            <input type="text" id="user" name="usuario" class="form-control" placeholder="Usuario" required>
                        </div>
                        <div class="form-group">
                            <label for="password">Contraseña</label>
                            <input type="password" id="password" name="password" class="form-control" placeholder="Contraseña" required>
                        </div>
                        <button type="submit" class="btn btn-primary">Guardar Doctor</button>
                    </form>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal para editar doctor -->
    <div class="modal fade" id="editDoctorModal" tabindex="-1" aria-labelledby="editDoctorModalLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="editDoctorModalLabel">Editar Doctor</h5>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>
                <div class="modal-body">
                    <form action="/updatedoctor" method="POST">
                        <input id="editDoctorId" name="iddoctor" hidden>

                        <!-- No editable: Cédula/DPI -->
                        <div class="form-group">
                            <label for="editDpi">DPI</label>
                            <input type="text" class="form-control" id="editDpi" name="dpi" disabled>
                        </div>

                        <!-- No editable: Nombre -->
                        <div class="form-group">
                            <label for="editDoctorName" class="form-label">Nombre</label>
                            <input type="text" class="form-control" id="editDoctorName" name="nombre" disabled>
                        </div>

                        <!-- No editable: Apellido -->
                        <div class="form-group">
                            <label for="editDoctorLastName" class="form-label">Apellido</label>
                            <input type="text" class="form-control" id="editDoctorLastName" name="apellido" disabled>
                        </div>

                        <!-- No editable: Fecha de Nacimiento -->
                        <div class="form-group">
                            <label for="editFechaNacimiento">Fecha de Nacimiento</label>
                            <input type="date" class="form-control" id="editFechaNacimiento" name="fechaNacimiento" disabled>
                        </div>

                        <!-- No editable: Género -->
                        <div class="form-group">
                            <label for="editDoctorGenero">Género</label>
                            <select id="editDoctorGenero" name="genero_idGenero" class="form-control" required disabled>
                                <option value="1">Masculino</option>
                                <option value="2">Femenino</option>
                                <option value="3">Otro</option>
                            </select>
                        </div>

                        <!-- No editable: Tipo de Sangre -->
                        <div class="form-group">
                            <label for="editTipoSangre">Tipo de Sangre</label>
                            <input type="text" class="form-control" id="editTipoSangre" name="tipoSangre" disabled>
                        </div>

                        <!-- Domicilio -->
                        <div class="form-group">
                            <label for="editDomicilio">Domicilio</label>
                            <input type="text" class="form-control" id="editDomicilio" name="domicilio">
                        </div>

                        <!-- Teléfono -->
                        <div class="form-group">
                            <label for="editDoctorPhone" class="form-label">Teléfono</label>
                            <input type="text" class="form-control" id="editDoctorPhone" name="telefono">
                        </div>

                        <!-- Email -->
                        <div class="form-group">
                            <label for="editDoctorEmail" class="form-label">Email</label>
                            <input type="email" class="form-control" id="editDoctorEmail" name="email">
                        </div>

                        <!-- Especialidad -->
                        <div class="form-group">
                            <label>Especialidad</label>
                            <select id="editDoctorSpecialty" name="especialidad" class="form-control">
                                <option value="">Seleccione una especialidad</option>
                                <option value="1">Dentista General</option>
                                <option value="2">Ortodoncista</option>
                                <option value="3">Cirujano Maxilofacial</option>
                                <option value="4">Endodoncia</option>
                                <option value="5">Periodoncia</option>
                                <option value="6">Odontólogo Cosmético</option>
                                <option value="7">Odontólogo Restaurador</option>
                                <option value="8">Prótesis Dental</option>
                            </select>
                        </div>

                        <!-- Observaciones -->
                        <div class="form-group">
                            <label for="editDoctorObservations" class="form-label">Observaciones</label>
                            <textarea class="form-control" id="editDoctorObservations" name="observaciones"></textarea>
                        </div>

                        <button type="submit" class="btn btn-success">Guardar Cambios</button>
                    </form>                  
                </div>
            </div>
        </div>
    </div>

    <!-- Pie de página -->
    <footer class="bg-dark text-white text-center py-3 mt-4">
        <p class="mb-0">&copy; 2024 SHINE DENTAL. Todos los derechos reservados.</p>
    </footer>
    <!-- /Pie de página -->

   <!-- Scripts -->
   <script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
   <script src="https://cdn.datatables.net/1.10.21/js/jquery.dataTables.min.js"></script>
   <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.5.2/dist/umd/popper.min.js"></script>
   <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>
   <script src="/js/dashboard.js"></script>

   <script>
        $(document).ready(function() {
            // Inicializa DataTables
            var table = $('#doctorTable').DataTable({
                destroy: true,
                paging: true,
                searching: true,
                ordering: true,
                info: true,
                lengthChange: false,
                language: {
                    info: "Mostrando _START_ a _END_ de _TOTAL_ entradas",
                    paginate: {
                        next: 'Siguiente',
                        previous: 'Anterior',
                    },
                    emptyTable: 'No hay doctores disponibles'
                },
                order: []
            });

            // Vincula el campo de búsqueda al DataTable
            $('#searchDoctor').on('keyup', function() {
                table.search(this.value).draw();
            });
        });

        // Función para agregar Doctor
        function guardarDoctor() {
            const nombre = $('#addDoctorName').val();
            const apellido = $('#addDoctorLastName').val();
            const dpi = $('#addDoctorDPI').val();
            const fechaNacimiento = $('#addDoctorBirthdate').val();
            const tipoSangre = $('#addDoctorBloodType').val();
            const genero = $('#addDoctorGenero').val();
            const domicilio = $('#addDoctorAddress').val();
            const telefono = $('#addDoctorPhone').val();
            const email = $('#addDoctorEmail').val();
            const especialidad = $('#addDoctorSpecialty').val();
            const rol = $('#addDoctorRol').val();
            const usuario = $('#addDoctorUser').val();
            const password = $('#addDoctorPassword').val();

            $.ajax({
                type: 'POST',
                url: '/admin/doctores',
                data: JSON.stringify({
                    nombre, apellido, dpi, fechaNacimiento, tipoSangre, genero, domicilio, telefono, email, especialidad, rol, usuario, password
                }),
                contentType: 'application/json',
                success: function(response) {
                    alert('Doctor agregado exitosamente.');
                    $('#addDoctorModal').modal('hide');
                    location.reload();
                },
                error: function(err) {
                    console.error('Error al agregar doctor:', err);
                }
            });
        }

        // Función para editar doctor
        function editarDoctor(id, nombre, apellido, telefono, email, observaciones, especialidadId, dpi, fechaNacimiento, tipoSangre, generoId, domicilio) {
            $('#editDoctorId').val(id);  // Set Doctor ID
            $('#editDoctorName').val(nombre);  // Set Doctor Name
            $('#editDoctorLastName').val(apellido);  // Set Doctor Last Name
            $('#editDoctorPhone').val(telefono);  // Set Phone
            $('#editDoctorEmail').val(email);  // Set Email
            $('#editDoctorObservations').val(observaciones);  // Set Observations
            $('#editDomicilio').val(domicilio);  // Set Domicilio
            
            // Campos no editables
            $('#editDpi').val(dpi).prop('readonly', true);  // DPI no editable
            $('#editFechaNacimiento').val(fechaNacimiento).prop('readonly', true);  // Fecha de nacimiento no editable
            $('#editTipoSangre').val(tipoSangre).prop('readonly', true);  // Tipo de sangre no editable
            
            // Establecer género
            $('#editDoctorGenero').val(generoId);  // Set Gender
            
            // Establecer especialidad
            $('#editDoctorSpecialty').val(especialidadId);  // Set Specialty by its ID

            // Mostrar el modal
            $('#editDoctorModal').modal('show');
        }
        // Función para guardar los cambios al editar doctor
        function actualizarDoctor() {
            const id = $('#editDoctorId').val();
            const nombre = $('#editDoctorName').val();
            const apellido = $('#editDoctorLastName').val();
            const telefono = $('#editDoctorPhone').val();
            const email = $('#editDoctorEmail').val();
            const especialidad = $('#editDoctorSpecialty').val();
            const observaciones = $('#editDoctorObservations').val();
            const domicilio = $('#editDoctorAddress').val();

            // Realizar la petición AJAX para actualizar los datos del doctor
            $.ajax({
                type: 'PUT',
                url: `/admin/doctores/${id}`,
                data: JSON.stringify({
                    nombre, apellido, telefono, email, especialidad, observaciones, domicilio
                }),
                contentType: 'application/json',
                success: function(response) {
                    alert('Doctor actualizado exitosamente.');
                    $('#editDoctorModal').modal('hide');
                    location.reload();  // Recargar la página para ver los cambios
                },
                error: function(err) {
                    console.error('Error al actualizar doctor:', err);
                    alert('Ocurrió un error al actualizar los datos del doctor.');
                }
            });
        }

        // Función para ver la información del doctor
        function verInformacion(id, usuarioId, nombre, apellido, telefono, email, observaciones, especialidadId, dpi, fechaNacimiento, tipoSangre, generoId, domicilio) {
            // Formatear la fecha de nacimiento
            const formattedFechaNacimiento = new Date(fechaNacimiento).toLocaleDateString('es-ES', {
                year: 'numeric',
                month: 'long',
                day: 'numeric'
            });

            // Convertir especialidadId a cadena de texto para asegurar coincidencia
            let especialidad;
            switch (especialidadId.toString()) {
                case '1':
                    especialidad = 'Dentista General';
                    break;
                case '2':
                    especialidad = 'Ortodoncista';
                    break;
                case '3':
                    especialidad = 'Cirujano Maxilofacial';
                    break;
                case '4':
                    especialidad = 'Endodoncia';
                    break;
                case '5':
                    especialidad = 'Periodoncia';
                    break;
                case '6':
                    especialidad = 'Odontólogo Cosmético';
                    break;
                case '7':
                    especialidad = 'Odontólogo Restaurador';
                    break;
                case '8':
                    especialidad = 'Prótesis Dental';
                    break;
                default:
                    especialidad = 'Otro';
                    break;
            }

            // Convertir generoId a cadena de texto para asegurar coincidencia
            let genero;
            switch (generoId.toString()) {
                case '1':
                    genero = 'Masculino';
                    break;
                case '2':
                    genero = 'Femenino';
                    break;
                default:
                    especialidad = 'Otro';
                    break;
            }

            // Asignar los valores a los campos del modal
            $('#infoDoctorId').text(id);
            $('#infoDoctorUserId').text(usuarioId ? usuarioId : 'N/A');
            $('#infoDoctorName').text(nombre);
            $('#infoDoctorLastName').text(apellido);
            $('#infoDoctorSpecialty').text(especialidad);
            $('#infoDoctorPhone').text(telefono);
            $('#infoDoctorEmail').text(email);
            $('#infoDoctorDPI').text(dpi ? dpi : 'N/A');
            $('#infoDoctorBirthdate').text(fechaNacimiento ? formattedFechaNacimiento : 'N/A');
            $('#infoDoctorGenero').text(genero);
            $('#infoDoctorBloodType').text(tipoSangre ? tipoSangre : 'N/A');
            $('#infoDoctorAddress').text(domicilio ? domicilio : 'N/A');
            $('#infoDoctorObservations').text(observaciones ? observaciones : 'N/A');

            // Mostrar el modal
            $('#infoDoctorModal').modal('show');
        }

        // Gestión de horarios laborales
        $('#formHorarioLaboral').submit(function(e) {
            e.preventDefault();

            const doctorId = $('#doctor').val();
            const diaSemana = $('#diaSemana').val();
            const horaInicio = $('#horaInicio').val();
            const horaFin = $('#horaFin').val();

            if (horaInicio >= horaFin) {
                alert('La hora de inicio debe ser menor que la hora de fin.');
                return;
            }

            $.ajax({
                type: 'POST',
                url: '/admin/guardarHorario',
                data: JSON.stringify({
                    doctorId: doctorId,
                    diaSemana: diaSemana,
                    horaInicio: horaInicio,
                    horaFin: horaFin
                }),
                contentType: 'application/json',
                success: function(response) {
                    alert('Horario guardado exitosamente');
                    location.reload();
                },
                error: function(err) {
                    console.error('Error al guardar horario:', err);
                    alert('Hubo un error al guardar el horario');
                }
            });
        });

        document.addEventListener('DOMContentLoaded', function() {
            // Fetch doctor schedules from the server on page load
            fetch('/admin/doctores/horarios')
            .then(response => {
                if (!response.ok) {
                    throw new Error(`Server responded with status ${response.status}`);
                }
                return response.json();
            })
            .then(horarios => {
                const horarioList = document.getElementById('horarioList');
                horarioList.innerHTML = ''; // Clear existing content

                if (horarios.length === 0) {
                    horarioList.innerHTML = '<tr><td colspan="5">No hay horarios disponibles</td></tr>';
                } else {
                    horarios.forEach(horario => {
                        const row = `
                            <tr>
                                <td>${horario.doctor}</td>
                                <td>${horario.dia_semana}</td>
                                <td>${horario.hora_inicio}</td>
                                <td>${horario.hora_fin}</td>
                                <td>
                                    <button class="btn btn-primary btn-sm" onclick="editarHorario(${horario.id})">-</button>
                                    <button class="btn btn-danger btn-sm" onclick="eliminarHorario(${horario.id})">-</button>
                                </td>
                            </tr>`;
                        horarioList.innerHTML += row;
                    });
                }
            })
            .catch(error => {
                console.error('Error fetching schedules:', error);
                const horarioList = document.getElementById('horarioList');
                horarioList.innerHTML = '<tr><td colspan="5">Error al cargar los horarios</td></tr>';
            });

            // Add new schedule using FormData
            document.getElementById('formHorarioLaboral').addEventListener('submit', function(event) {
                event.preventDefault();

                const horaInicio = document.getElementById('horaInicio').value;
                const horaFin = document.getElementById('horaFin').value;

                // Validate that start time is earlier than end time
                if (horaInicio >= horaFin) {
                    alert('La hora de inicio debe ser anterior a la hora de fin.');
                    return;
                }

                const formData = new FormData(this);
                const data = Object.fromEntries(formData.entries());

                fetch('/admin/doctores/horarios', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(data),
                })
                .then(response => {
                    if (response.ok) {
                        alert('Horario guardado');
                        location.reload();
                    } else {
                        alert('Error al guardar el horario');
                    }
                })
                .catch(error => console.error('Error al guardar el horario:', error));
            });

            // Fetch available doctors and populate select options
            fetch('/admin/doctores')
                .then(response => response.json())
                .then(doctores => {
                    const doctorSelect = document.getElementById('doctor');
                    doctorSelect.innerHTML = ''; // Clear existing options
                    const defaultOption = document.createElement('option');
                    defaultOption.value = '';
                    defaultOption.textContent = 'Seleccione un Doctor';
                    doctorSelect.appendChild(defaultOption);

                    doctores.forEach(doctor => {
                        const option = document.createElement('option');
                        option.value = doctor.iddoctor;
                        option.textContent = `${doctor.nombre} ${doctor.apellido}`;
                        doctorSelect.appendChild(option);
                    });
                })
                .catch(error => console.error('Error al cargar doctores:', error));
        });

        // Function to edit an existing schedule
        function editarHorario(id) {
            console.log('Edit schedule ID:', id);
            // Here you can open a modal and populate it with the selected schedule details
        }

        // Function to delete an existing schedule
        function eliminarHorario(id) {
            console.log('Delete schedule ID:', id);
            // Implement logic to delete the selected schedule
        }
    </script>
</body>
</html>